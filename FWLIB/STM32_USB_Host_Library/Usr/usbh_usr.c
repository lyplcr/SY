/*
*********************************************************************************************************
* @file    	usbh_usr.c
* @author  	SY
* @version 	V1.0.0
* @date    	2016-10-21 12:39:19
* @IDE	 	Keil V5.18.0.0
* @Chip    	STM32F407VE
* @brief   	USB用户层源文件
*********************************************************************************************************
* @attention
*
* 
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                              				Private Includes
*********************************************************************************************************
*/
#include "bsp.h"
#include "usbh_usr.h"
#include "ff_gen_drv.h"

/*
*********************************************************************************************************
*                              				Private define
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                              				Private typedef
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                              				Private constants
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                              				Private macro
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                              				Private variables
*********************************************************************************************************
*/
USBH_HandleTypeDef hUsbHostHS;
static USB_HOST_STATUS_TypeDef Appli_state = USB_HOST_IDLE;

extern FATFS USBFatFs;
extern char USBPath[];
	
/*
*********************************************************************************************************
*                              				Private function prototypes
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                              				Private functions
*********************************************************************************************************
*/
/*
*********************************************************************************************************
* Function Name : USBH_UserProcess
* Description	: 用户回调函数
* Input			: None
* Output		: None
* Return		: None
*********************************************************************************************************
*/
void USBH_UserProcess(USBH_HandleTypeDef *phost, uint8_t id)
{
	switch(id)
	{ 
		case HOST_USER_SELECT_CONFIGURATION:
			break;

		case HOST_USER_DISCONNECTION:
		{	
		#if 0		
			if (f_mount(NULL, (TCHAR const*)USBPath, 0) != FR_OK)
			{
				bsp_ErrorHandler();
			}
		#endif	
			
			Appli_state = USB_HOST_DISCONNECT;
			ECHO(DEBUG_BSP_USB,"USB断开连接！");
			break;
		}
		case HOST_USER_CLASS_ACTIVE:
		{		
			if (f_mount(&USBFatFs, (TCHAR const*)USBPath, 0) != FR_OK)
			{
				bsp_ErrorHandler();
			}
			
			Appli_state = USB_HOST_READY;
			ECHO(DEBUG_BSP_USB,"USB已就绪！");
			break;
		}
		case HOST_USER_CONNECTION:
		{
			Appli_state = USB_HOST_CONNECT;
			ECHO(DEBUG_BSP_USB,"USB建立连接！");
			break;
		}
		default:
			break; 
	}
}

/*
*********************************************************************************************************
* Function Name : USBH_GetStatus
* Description	: 获取USB状态
* Input			: None
* Output		: None
* Return		: None
*********************************************************************************************************
*/
USB_HOST_STATUS_TypeDef USBH_GetStatus( void )
{
	return Appli_state;
}

/************************ (C) COPYRIGHT STMicroelectronics **********END OF FILE*************************/
